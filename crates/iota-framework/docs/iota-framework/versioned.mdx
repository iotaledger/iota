---
title: Module 0x2::versioned
sidebar_label: versioned
---
import Link from '@docusaurus/Link';

<Link id="0x2_versioned"/>


-  [Resource `Versioned`](#0x2_versioned_Versioned)
-  [Struct `VersionChangeCap`](#0x2_versioned_VersionChangeCap)
-  [Constants](#@Constants_0)
-  [Function `create`](#0x2_versioned_create)
-  [Function `version`](#0x2_versioned_version)
-  [Function `load_value`](#0x2_versioned_load_value)
-  [Function `load_value_mut`](#0x2_versioned_load_value_mut)
-  [Function `remove_value_for_upgrade`](#0x2_versioned_remove_value_for_upgrade)
-  [Function `upgrade`](#0x2_versioned_upgrade)
-  [Function `destroy`](#0x2_versioned_destroy)


<pre><code>
<b>use</b> <Link to="../iota-framework/dynamic_field#0x2_dynamic_field">0x2::dynamic_field</Link>;
<b>use</b> <Link to="../iota-framework/object#0x2_object">0x2::object</Link>;
<b>use</b> <Link to="../iota-framework/tx_context#0x2_tx_context">0x2::tx_context</Link>;
</code></pre>



<Link id="0x2_versioned_Versioned"></Link>

## Resource `Versioned`

A wrapper type that supports versioning of the inner type.
The inner type is a dynamic field of the Versioned object, and is keyed using version.
User of this type could load the inner object using corresponding type based on the version.
You can also upgrade the inner object to a new type version.
If you want to support lazy upgrade of the inner type, one caveat is that all APIs would have
to use mutable reference even if it's a read-only API.


<pre><code>
<b>struct</b> <Link to="../iota-framework/versioned#0x2_versioned_Versioned">Versioned</Link> <b>has</b> store, key
</code></pre>



<details>
<summary>Fields</summary>


<dl>
<dt>

id: <Link to="../iota-framework/object#0x2_object_UID">object::UID</Link>
</dt>
<dd>

</dd>
<dt>

version: u64
</dt>
<dd>

</dd>
</dl>


</details>

<Link id="0x2_versioned_VersionChangeCap"></Link>

## Struct `VersionChangeCap`

Represents a hot potato object generated when we take out the dynamic field.
This is to make sure that we always put a new value back.


<pre><code>
<b>struct</b> <Link to="../iota-framework/versioned#0x2_versioned_VersionChangeCap">VersionChangeCap</Link>
</code></pre>



<details>
<summary>Fields</summary>


<dl>
<dt>

versioned_id: <Link to="../iota-framework/object#0x2_object_ID">object::ID</Link>
</dt>
<dd>

</dd>
<dt>

old_version: u64
</dt>
<dd>

</dd>
</dl>


</details>

<Link id="@Constants_0"></Link>

## Constants


<Link id="0x2_versioned_EInvalidUpgrade"></Link>

Failed to upgrade the inner object due to invalid capability or new version.


<pre><code>
<b>const</b> <Link to="../iota-framework/versioned#0x2_versioned_EInvalidUpgrade">EInvalidUpgrade</Link>: u64 = 0;
</code></pre>



<Link id="0x2_versioned_create"></Link>

## Function `create`

Create a new Versioned object that contains a initial value of type 
T with an initial version.


<pre><code>
<b>public</b> <b>fun</b> <Link to="../iota-framework/versioned#0x2_versioned_create">create</Link>&lt;T: store&gt;(init_version: u64, init_value: T, ctx: &<b>mut</b> <Link to="../iota-framework/tx_context#0x2_tx_context_TxContext">tx_context::TxContext</Link>): <Link to="../iota-framework/versioned#0x2_versioned_Versioned">versioned::Versioned</Link>
</code></pre>



<details>
<summary>Implementation</summary>


<pre><code>
<b>public</b> <b>fun</b> <Link to="../iota-framework/versioned#0x2_versioned_create">create</Link>&lt;T: store&gt;(init_version: u64, init_value: T, ctx: &<b>mut</b> TxContext): <Link to="../iota-framework/versioned#0x2_versioned_Versioned">Versioned</Link> \{
    <b>let</b> <b>mut</b> self = <Link to="../iota-framework/versioned#0x2_versioned_Versioned">Versioned</Link> \{
        id: <Link to="../iota-framework/object#0x2_object_new">object::new</Link>(ctx),
        version: init_version,
    };
    <Link to="../iota-framework/dynamic_field#0x2_dynamic_field_add">dynamic_field::add</Link>(&<b>mut</b> self.id, init_version, init_value);
    self
}
</code></pre>



</details>

<Link id="0x2_versioned_version"></Link>

## Function `version`

Get the current version of the inner type.


<pre><code>
<b>public</b> <b>fun</b> <Link to="../iota-framework/versioned#0x2_versioned_version">version</Link>(self: &<Link to="../iota-framework/versioned#0x2_versioned_Versioned">versioned::Versioned</Link>): u64
</code></pre>



<details>
<summary>Implementation</summary>


<pre><code>
<b>public</b> <b>fun</b> <Link to="../iota-framework/versioned#0x2_versioned_version">version</Link>(self: &<Link to="../iota-framework/versioned#0x2_versioned_Versioned">Versioned</Link>): u64 \{
    self.version
}
</code></pre>



</details>

<Link id="0x2_versioned_load_value"></Link>

## Function `load_value`

Load the inner value based on the current version. Caller specifies an expected type T.
If the type mismatch, the load will fail.


<pre><code>
<b>public</b> <b>fun</b> <Link to="../iota-framework/versioned#0x2_versioned_load_value">load_value</Link>&lt;T: store&gt;(self: &<Link to="../iota-framework/versioned#0x2_versioned_Versioned">versioned::Versioned</Link>): &T
</code></pre>



<details>
<summary>Implementation</summary>


<pre><code>
<b>public</b> <b>fun</b> <Link to="../iota-framework/versioned#0x2_versioned_load_value">load_value</Link>&lt;T: store&gt;(self: &<Link to="../iota-framework/versioned#0x2_versioned_Versioned">Versioned</Link>): &T \{
    <Link to="../iota-framework/dynamic_field#0x2_dynamic_field_borrow">dynamic_field::borrow</Link>(&self.id, self.version)
}
</code></pre>



</details>

<Link id="0x2_versioned_load_value_mut"></Link>

## Function `load_value_mut`

Similar to load_value, but return a mutable reference.


<pre><code>
<b>public</b> <b>fun</b> <Link to="../iota-framework/versioned#0x2_versioned_load_value_mut">load_value_mut</Link>&lt;T: store&gt;(self: &<b>mut</b> <Link to="../iota-framework/versioned#0x2_versioned_Versioned">versioned::Versioned</Link>): &<b>mut</b> T
</code></pre>



<details>
<summary>Implementation</summary>


<pre><code>
<b>public</b> <b>fun</b> <Link to="../iota-framework/versioned#0x2_versioned_load_value_mut">load_value_mut</Link>&lt;T: store&gt;(self: &<b>mut</b> <Link to="../iota-framework/versioned#0x2_versioned_Versioned">Versioned</Link>): &<b>mut</b> T \{
    <Link to="../iota-framework/dynamic_field#0x2_dynamic_field_borrow_mut">dynamic_field::borrow_mut</Link>(&<b>mut</b> self.id, self.version)
}
</code></pre>



</details>

<Link id="0x2_versioned_remove_value_for_upgrade"></Link>

## Function `remove_value_for_upgrade`

Take the inner object out for upgrade. To ensure we always upgrade properly, a capability object is returned
and must be used when we upgrade.


<pre><code>
<b>public</b> <b>fun</b> <Link to="../iota-framework/versioned#0x2_versioned_remove_value_for_upgrade">remove_value_for_upgrade</Link>&lt;T: store&gt;(self: &<b>mut</b> <Link to="../iota-framework/versioned#0x2_versioned_Versioned">versioned::Versioned</Link>): (T, <Link to="../iota-framework/versioned#0x2_versioned_VersionChangeCap">versioned::VersionChangeCap</Link>)
</code></pre>



<details>
<summary>Implementation</summary>


<pre><code>
<b>public</b> <b>fun</b> <Link to="../iota-framework/versioned#0x2_versioned_remove_value_for_upgrade">remove_value_for_upgrade</Link>&lt;T: store&gt;(self: &<b>mut</b> <Link to="../iota-framework/versioned#0x2_versioned_Versioned">Versioned</Link>): (T, <Link to="../iota-framework/versioned#0x2_versioned_VersionChangeCap">VersionChangeCap</Link>) \{
    (
        <Link to="../iota-framework/dynamic_field#0x2_dynamic_field_remove">dynamic_field::remove</Link>(&<b>mut</b> self.id, self.version),
        <Link to="../iota-framework/versioned#0x2_versioned_VersionChangeCap">VersionChangeCap</Link> \{
            versioned_id: <Link to="../iota-framework/object#0x2_object_id">object::id</Link>(self),
            old_version: self.version,
        }
    )
}
</code></pre>



</details>

<Link id="0x2_versioned_upgrade"></Link>

## Function `upgrade`

Upgrade the inner object with a new version and new value. Must use the capability returned
by calling remove_value_for_upgrade.


<pre><code>
<b>public</b> <b>fun</b> <Link to="../iota-framework/versioned#0x2_versioned_upgrade">upgrade</Link>&lt;T: store&gt;(self: &<b>mut</b> <Link to="../iota-framework/versioned#0x2_versioned_Versioned">versioned::Versioned</Link>, new_version: u64, new_value: T, cap: <Link to="../iota-framework/versioned#0x2_versioned_VersionChangeCap">versioned::VersionChangeCap</Link>)
</code></pre>



<details>
<summary>Implementation</summary>


<pre><code>
<b>public</b> <b>fun</b> <Link to="../iota-framework/versioned#0x2_versioned_upgrade">upgrade</Link>&lt;T: store&gt;(self: &<b>mut</b> <Link to="../iota-framework/versioned#0x2_versioned_Versioned">Versioned</Link>, new_version: u64, new_value: T, cap: <Link to="../iota-framework/versioned#0x2_versioned_VersionChangeCap">VersionChangeCap</Link>) \{
    <b>let</b> <Link to="../iota-framework/versioned#0x2_versioned_VersionChangeCap">VersionChangeCap</Link> \{ versioned_id, old_version } = cap;
    <b>assert</b>!(versioned_id == <Link to="../iota-framework/object#0x2_object_id">object::id</Link>(self), <Link to="../iota-framework/versioned#0x2_versioned_EInvalidUpgrade">EInvalidUpgrade</Link>);
    <b>assert</b>!(old_version &lt; new_version, <Link to="../iota-framework/versioned#0x2_versioned_EInvalidUpgrade">EInvalidUpgrade</Link>);
    <Link to="../iota-framework/dynamic_field#0x2_dynamic_field_add">dynamic_field::add</Link>(&<b>mut</b> self.id, new_version, new_value);
    self.version = new_version;
}
</code></pre>



</details>

<Link id="0x2_versioned_destroy"></Link>

## Function `destroy`

Destroy this Versioned container, and return the inner object.


<pre><code>
<b>public</b> <b>fun</b> <Link to="../iota-framework/versioned#0x2_versioned_destroy">destroy</Link>&lt;T: store&gt;(self: <Link to="../iota-framework/versioned#0x2_versioned_Versioned">versioned::Versioned</Link>): T
</code></pre>



<details>
<summary>Implementation</summary>


<pre><code>
<b>public</b> <b>fun</b> <Link to="../iota-framework/versioned#0x2_versioned_destroy">destroy</Link>&lt;T: store&gt;(self: <Link to="../iota-framework/versioned#0x2_versioned_Versioned">Versioned</Link>): T \{
    <b>let</b> <Link to="../iota-framework/versioned#0x2_versioned_Versioned">Versioned</Link> \{ <b>mut</b> id, version } = self;
    <b>let</b> ret = <Link to="../iota-framework/dynamic_field#0x2_dynamic_field_remove">dynamic_field::remove</Link>(&<b>mut</b> id, version);
    id.delete();
    ret
}
</code></pre>



</details>
