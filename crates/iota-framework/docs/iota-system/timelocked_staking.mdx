---
title: Module 0x3::timelocked_staking
sidebar_label: timelocked_staking
---
import Link from '@docusaurus/Link';

<Link id="0x3_timelocked_staking"/>


-  [Resource `TimelockedStakedIota`](#0x3_timelocked_staking_TimelockedStakedIota)
-  [Constants](#@Constants_0)
-  [Function `request_add_stake`](#0x3_timelocked_staking_request_add_stake)
-  [Function `request_add_stake_mul_bal`](#0x3_timelocked_staking_request_add_stake_mul_bal)
-  [Function `request_withdraw_stake`](#0x3_timelocked_staking_request_withdraw_stake)
-  [Function `request_add_stake_non_entry`](#0x3_timelocked_staking_request_add_stake_non_entry)
-  [Function `request_add_stake_mul_bal_non_entry`](#0x3_timelocked_staking_request_add_stake_mul_bal_non_entry)
-  [Function `request_withdraw_stake_non_entry`](#0x3_timelocked_staking_request_withdraw_stake_non_entry)
-  [Function `split`](#0x3_timelocked_staking_split)
-  [Function `split_staked_iota`](#0x3_timelocked_staking_split_staked_iota)
-  [Function `join_staked_iota`](#0x3_timelocked_staking_join_staked_iota)
-  [Function `transfer_to_sender`](#0x3_timelocked_staking_transfer_to_sender)
-  [Function `transfer_to_sender_multiple`](#0x3_timelocked_staking_transfer_to_sender_multiple)
-  [Function `is_equal_staking_metadata`](#0x3_timelocked_staking_is_equal_staking_metadata)
-  [Function `pool_id`](#0x3_timelocked_staking_pool_id)
-  [Function `staked_iota_amount`](#0x3_timelocked_staking_staked_iota_amount)
-  [Function `stake_activation_epoch`](#0x3_timelocked_staking_stake_activation_epoch)
-  [Function `expiration_timestamp_ms`](#0x3_timelocked_staking_expiration_timestamp_ms)
-  [Function `label`](#0x3_timelocked_staking_label)
-  [Function `is_labeled_with`](#0x3_timelocked_staking_is_labeled_with)
-  [Function `unpack`](#0x3_timelocked_staking_unpack)
-  [Function `transfer`](#0x3_timelocked_staking_transfer)
-  [Function `transfer_multiple`](#0x3_timelocked_staking_transfer_multiple)
-  [Function `request_add_stake_at_genesis`](#0x3_timelocked_staking_request_add_stake_at_genesis)


<pre>
<code>
<b>use</b> <Link to="../move-stdlib/option#0x1_option">0x1::option</Link>;
<b>use</b> <Link to="../move-stdlib/string#0x1_string">0x1::string</Link>;
<b>use</b> <Link to="../move-stdlib/vector#0x1_vector">0x1::vector</Link>;
<b>use</b> <Link to="../iota-framework/balance#0x2_balance">0x2::balance</Link>;
<b>use</b> <Link to="../iota-framework/coin#0x2_coin">0x2::coin</Link>;
<b>use</b> <Link to="../iota-framework/iota#0x2_iota">0x2::iota</Link>;
<b>use</b> <Link to="../iota-framework/object#0x2_object">0x2::object</Link>;
<b>use</b> <Link to="../iota-framework/timelock#0x2_timelock">0x2::timelock</Link>;
<b>use</b> <Link to="../iota-framework/transfer#0x2_transfer">0x2::transfer</Link>;
<b>use</b> <Link to="../iota-framework/tx_context#0x2_tx_context">0x2::tx_context</Link>;
<b>use</b> <Link to="iota_system#0x3_iota_system">0x3::iota_system</Link>;
<b>use</b> <Link to="staking_pool#0x3_staking_pool">0x3::staking_pool</Link>;
<b>use</b> <Link to="validator#0x3_validator">0x3::validator</Link>;
</code>
</pre>



<Link id="0x3_timelocked_staking_TimelockedStakedIota"></Link>

## Resource `TimelockedStakedIota`

A self-custodial object holding the timelocked staked IOTA tokens.


<pre>
<code>
<b>struct</b> <Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link> <b>has</b> key
</code>
</pre>



<details>
<summary>Fields</summary>


<dl>
<dt>
<code>id: <Link to="../iota-framework/object#0x2_object_UID">object::UID</Link></code>
</dt>
<dd>

</dd>
<dt>
<code>staked_iota: <Link to="staking_pool#0x3_staking_pool_StakedIota">staking_pool::StakedIota</Link></code>
</dt>
<dd>
 A self-custodial object holding the staked IOTA tokens.
</dd>
<dt>
<code>expiration_timestamp_ms: u64</code>
</dt>
<dd>
 This is the epoch time stamp of when the lock expires.
</dd>
<dt>
<code>label: <Link to="../move-stdlib/option#0x1_option_Option">option::Option</Link>&lt;<Link to="../move-stdlib/string#0x1_string_String">string::String</Link>&gt;</code>
</dt>
<dd>
 Timelock related label.
</dd>
</dl>


</details>

<Link id="@Constants_0"></Link>

## Constants


<Link id="0x3_timelocked_staking_EIncompatibleTimelockedStakedIota"></Link>

Incompatible objects when joining TimelockedStakedIota


<pre>
<code>
<b>const</b> <Link to="timelocked_staking#0x3_timelocked_staking_EIncompatibleTimelockedStakedIota">EIncompatibleTimelockedStakedIota</Link>: u64 = 1;
</code>
</pre>



<Link id="0x3_timelocked_staking_ETimeLockShouldNotBeExpired"></Link>

For when trying to stake an expired time-locked balance.


<pre>
<code>
<b>const</b> <Link to="timelocked_staking#0x3_timelocked_staking_ETimeLockShouldNotBeExpired">ETimeLockShouldNotBeExpired</Link>: u64 = 0;
</code>
</pre>



<Link id="0x3_timelocked_staking_request_add_stake"></Link>

## Function `request_add_stake`

Add a time-locked stake to a validator's staking pool.


<pre>
<code>
<b>public</b> entry <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_request_add_stake">request_add_stake</Link>(<Link to="iota_system#0x3_iota_system">iota_system</Link>: &<b>mut</b> <Link to="iota_system#0x3_iota_system_IotaSystemState">iota_system::IotaSystemState</Link>, timelocked_balance: <Link to="../iota-framework/timelock#0x2_timelock_TimeLock">timelock::TimeLock</Link>&lt;<Link to="../iota-framework/balance#0x2_balance_Balance">balance::Balance</Link>&lt;<Link to="../iota-framework/iota#0x2_iota_IOTA">iota::IOTA</Link>&gt;&gt;, validator_address: <b>address</b>, ctx: &<b>mut</b> <Link to="../iota-framework/tx_context#0x2_tx_context_TxContext">tx_context::TxContext</Link>)
</code>
</pre>



<details>
<summary>Implementation</summary>


<pre>
<code>
<b>public</b> entry <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_request_add_stake">request_add_stake</Link>(
    <Link to="iota_system#0x3_iota_system">iota_system</Link>: &<b>mut</b> IotaSystemState,
    timelocked_balance: TimeLock&lt;Balance&lt;IOTA&gt;&gt;,
    validator_address: <b>address</b>,
    ctx: &<b>mut</b> TxContext,
) \{
    // Stake the time-locked <Link to="../iota-framework/balance#0x2_balance">balance</Link>.
    <b>let</b> timelocked_staked_iota = <Link to="timelocked_staking#0x3_timelocked_staking_request_add_stake_non_entry">request_add_stake_non_entry</Link>(<Link to="iota_system#0x3_iota_system">iota_system</Link>, timelocked_balance, validator_address, ctx);

    // Transfer the receipt <b>to</b> the sender.
    timelocked_staked_iota.<Link to="timelocked_staking#0x3_timelocked_staking_transfer_to_sender">transfer_to_sender</Link>(ctx);
}
</code>
</pre>



</details>

<Link id="0x3_timelocked_staking_request_add_stake_mul_bal"></Link>

## Function `request_add_stake_mul_bal`

Add a time-locked stake to a validator's staking pool using multiple time-locked balances.


<pre>
<code>
<b>public</b> entry <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_request_add_stake_mul_bal">request_add_stake_mul_bal</Link>(<Link to="iota_system#0x3_iota_system">iota_system</Link>: &<b>mut</b> <Link to="iota_system#0x3_iota_system_IotaSystemState">iota_system::IotaSystemState</Link>, timelocked_balances: <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;<Link to="../iota-framework/timelock#0x2_timelock_TimeLock">timelock::TimeLock</Link>&lt;<Link to="../iota-framework/balance#0x2_balance_Balance">balance::Balance</Link>&lt;<Link to="../iota-framework/iota#0x2_iota_IOTA">iota::IOTA</Link>&gt;&gt;&gt;, validator_address: <b>address</b>, ctx: &<b>mut</b> <Link to="../iota-framework/tx_context#0x2_tx_context_TxContext">tx_context::TxContext</Link>)
</code>
</pre>



<details>
<summary>Implementation</summary>


<pre>
<code>
<b>public</b> entry <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_request_add_stake_mul_bal">request_add_stake_mul_bal</Link>(
    <Link to="iota_system#0x3_iota_system">iota_system</Link>: &<b>mut</b> IotaSystemState,
    timelocked_balances: <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;TimeLock&lt;Balance&lt;IOTA&gt;&gt;&gt;,
    validator_address: <b>address</b>,
    ctx: &<b>mut</b> TxContext,
) \{
    // Stake the time-locked balances.
    <b>let</b> <b>mut</b> receipts = <Link to="timelocked_staking#0x3_timelocked_staking_request_add_stake_mul_bal_non_entry">request_add_stake_mul_bal_non_entry</Link>(<Link to="iota_system#0x3_iota_system">iota_system</Link>, timelocked_balances, validator_address, ctx);

    // Create useful variables.
    <b>let</b> (<b>mut</b> i, len) = (0, receipts.length());

    // Send all the receipts <b>to</b> the sender.
    <b>while</b> (i &lt; len) \{
        // Take a receipt.
        <b>let</b> receipt = receipts.pop_back();

        // Transfer the receipt <b>to</b> the sender.
        receipt.<Link to="timelocked_staking#0x3_timelocked_staking_transfer_to_sender">transfer_to_sender</Link>(ctx);

        i = i + 1
    };

    // Destroy the empty <Link to="../move-stdlib/vector#0x1_vector">vector</Link>.
    <Link to="../move-stdlib/vector#0x1_vector_destroy_empty">vector::destroy_empty</Link>(receipts)
}
</code>
</pre>



</details>

<Link id="0x3_timelocked_staking_request_withdraw_stake"></Link>

## Function `request_withdraw_stake`

Withdraw a time-locked stake from a validator's staking pool.


<pre>
<code>
<b>public</b> entry <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_request_withdraw_stake">request_withdraw_stake</Link>(<Link to="iota_system#0x3_iota_system">iota_system</Link>: &<b>mut</b> <Link to="iota_system#0x3_iota_system_IotaSystemState">iota_system::IotaSystemState</Link>, timelocked_staked_iota: <Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">timelocked_staking::TimelockedStakedIota</Link>, ctx: &<b>mut</b> <Link to="../iota-framework/tx_context#0x2_tx_context_TxContext">tx_context::TxContext</Link>)
</code>
</pre>



<details>
<summary>Implementation</summary>


<pre>
<code>
<b>public</b> entry <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_request_withdraw_stake">request_withdraw_stake</Link>(
    <Link to="iota_system#0x3_iota_system">iota_system</Link>: &<b>mut</b> IotaSystemState,
    timelocked_staked_iota: <Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link>,
    ctx: &<b>mut</b> TxContext,
) \{
    // Withdraw the time-locked <Link to="../iota-framework/balance#0x2_balance">balance</Link>.
    <b>let</b> (timelocked_balance, reward) = <Link to="timelocked_staking#0x3_timelocked_staking_request_withdraw_stake_non_entry">request_withdraw_stake_non_entry</Link>(<Link to="iota_system#0x3_iota_system">iota_system</Link>, timelocked_staked_iota, ctx);

    // Transfer the withdrawn time-locked <Link to="../iota-framework/balance#0x2_balance">balance</Link> <b>to</b> the sender.
   timelocked_balance.<Link to="timelocked_staking#0x3_timelocked_staking_transfer_to_sender">transfer_to_sender</Link>(ctx);

    // Send coins only <b>if</b> the reward is not zero.
    <b>if</b> (reward.value() &gt; 0) \{
        <Link to="../iota-framework/transfer#0x2_transfer_public_transfer">transfer::public_transfer</Link>(reward.into_coin(ctx), ctx.sender());
    }
    <b>else</b> \{
        <Link to="../iota-framework/balance#0x2_balance_destroy_zero">balance::destroy_zero</Link>(reward);
    }
}
</code>
</pre>



</details>

<Link id="0x3_timelocked_staking_request_add_stake_non_entry"></Link>

## Function `request_add_stake_non_entry`

The non-entry version of <code>request_add_stake</code>, which returns the time-locked staked IOTA instead of transferring it to the sender.


<pre>
<code>
<b>public</b> <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_request_add_stake_non_entry">request_add_stake_non_entry</Link>(<Link to="iota_system#0x3_iota_system">iota_system</Link>: &<b>mut</b> <Link to="iota_system#0x3_iota_system_IotaSystemState">iota_system::IotaSystemState</Link>, timelocked_balance: <Link to="../iota-framework/timelock#0x2_timelock_TimeLock">timelock::TimeLock</Link>&lt;<Link to="../iota-framework/balance#0x2_balance_Balance">balance::Balance</Link>&lt;<Link to="../iota-framework/iota#0x2_iota_IOTA">iota::IOTA</Link>&gt;&gt;, validator_address: <b>address</b>, ctx: &<b>mut</b> <Link to="../iota-framework/tx_context#0x2_tx_context_TxContext">tx_context::TxContext</Link>): <Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">timelocked_staking::TimelockedStakedIota</Link>
</code>
</pre>



<details>
<summary>Implementation</summary>


<pre>
<code>
<b>public</b> <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_request_add_stake_non_entry">request_add_stake_non_entry</Link>(
    <Link to="iota_system#0x3_iota_system">iota_system</Link>: &<b>mut</b> IotaSystemState,
    timelocked_balance: TimeLock&lt;Balance&lt;IOTA&gt;&gt;,
    validator_address: <b>address</b>,
    ctx: &<b>mut</b> TxContext,
) : <Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link> \{
    // Check the preconditions.
    <b>assert</b>!(timelocked_balance.is_locked(ctx), <Link to="timelocked_staking#0x3_timelocked_staking_ETimeLockShouldNotBeExpired">ETimeLockShouldNotBeExpired</Link>);

    // Unpack the time-locked <Link to="../iota-framework/balance#0x2_balance">balance</Link>.
    <b>let</b> sys_timelock_cap = <Link to="iota_system#0x3_iota_system">iota_system</Link>.load_system_timelock_cap();
    <b>let</b> (<Link to="../iota-framework/balance#0x2_balance">balance</Link>, expiration_timestamp_ms, label) = <Link to="../iota-framework/timelock#0x2_timelock_system_unpack">timelock::system_unpack</Link>(sys_timelock_cap, timelocked_balance);

    // Stake the time-locked <Link to="../iota-framework/balance#0x2_balance">balance</Link>.
    <b>let</b> staked_iota = <Link to="iota_system#0x3_iota_system">iota_system</Link>.<Link to="timelocked_staking#0x3_timelocked_staking_request_add_stake_non_entry">request_add_stake_non_entry</Link>(
        <Link to="../iota-framework/balance#0x2_balance">balance</Link>.into_coin(ctx),
        validator_address,
        ctx,
    );

    // Create and <b>return</b> a receipt.
    <Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link> \{
        id: <Link to="../iota-framework/object#0x2_object_new">object::new</Link>(ctx),
        staked_iota,
        expiration_timestamp_ms,
        label,
    }
}
</code>
</pre>



</details>

<Link id="0x3_timelocked_staking_request_add_stake_mul_bal_non_entry"></Link>

## Function `request_add_stake_mul_bal_non_entry`

The non-entry version of <code>request_add_stake_mul_bal</code>,
which returns a list of the time-locked staked IOTAs instead of transferring them to the sender.


<pre>
<code>
<b>public</b> <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_request_add_stake_mul_bal_non_entry">request_add_stake_mul_bal_non_entry</Link>(<Link to="iota_system#0x3_iota_system">iota_system</Link>: &<b>mut</b> <Link to="iota_system#0x3_iota_system_IotaSystemState">iota_system::IotaSystemState</Link>, timelocked_balances: <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;<Link to="../iota-framework/timelock#0x2_timelock_TimeLock">timelock::TimeLock</Link>&lt;<Link to="../iota-framework/balance#0x2_balance_Balance">balance::Balance</Link>&lt;<Link to="../iota-framework/iota#0x2_iota_IOTA">iota::IOTA</Link>&gt;&gt;&gt;, validator_address: <b>address</b>, ctx: &<b>mut</b> <Link to="../iota-framework/tx_context#0x2_tx_context_TxContext">tx_context::TxContext</Link>): <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;<Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">timelocked_staking::TimelockedStakedIota</Link>&gt;
</code>
</pre>



<details>
<summary>Implementation</summary>


<pre>
<code>
<b>public</b> <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_request_add_stake_mul_bal_non_entry">request_add_stake_mul_bal_non_entry</Link>(
    <Link to="iota_system#0x3_iota_system">iota_system</Link>: &<b>mut</b> IotaSystemState,
    <b>mut</b> timelocked_balances: <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;TimeLock&lt;Balance&lt;IOTA&gt;&gt;&gt;,
    validator_address: <b>address</b>,
    ctx: &<b>mut</b> TxContext,
) : <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;<Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link>&gt; \{
    // Create a <Link to="../move-stdlib/vector#0x1_vector">vector</Link> <b>to</b> store the results.
    <b>let</b> <b>mut</b> result = <Link to="../move-stdlib/vector#0x1_vector">vector</Link>[];

    // Create useful variables.
    <b>let</b> (<b>mut</b> i, len) = (0, timelocked_balances.length());

    // Stake all the time-locked balances.
    <b>while</b> (i &lt; len) \{
        // Take a time-locked <Link to="../iota-framework/balance#0x2_balance">balance</Link>.
        <b>let</b> timelocked_balance = timelocked_balances.pop_back();

        // Stake the time-locked <Link to="../iota-framework/balance#0x2_balance">balance</Link>.
        <b>let</b> timelocked_staked_iota = <Link to="timelocked_staking#0x3_timelocked_staking_request_add_stake_non_entry">request_add_stake_non_entry</Link>(<Link to="iota_system#0x3_iota_system">iota_system</Link>, timelocked_balance, validator_address, ctx);

        // Store the created receipt.
        result.push_back(timelocked_staked_iota);

        i = i + 1
    };

    // Destroy the empty <Link to="../move-stdlib/vector#0x1_vector">vector</Link>.
    <Link to="../move-stdlib/vector#0x1_vector_destroy_empty">vector::destroy_empty</Link>(timelocked_balances);

    result
}
</code>
</pre>



</details>

<Link id="0x3_timelocked_staking_request_withdraw_stake_non_entry"></Link>

## Function `request_withdraw_stake_non_entry`

Non-entry version of <code>request_withdraw_stake</code> that returns the withdrawn time-locked IOTA and reward
instead of transferring it to the sender.


<pre>
<code>
<b>public</b> <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_request_withdraw_stake_non_entry">request_withdraw_stake_non_entry</Link>(<Link to="iota_system#0x3_iota_system">iota_system</Link>: &<b>mut</b> <Link to="iota_system#0x3_iota_system_IotaSystemState">iota_system::IotaSystemState</Link>, timelocked_staked_iota: <Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">timelocked_staking::TimelockedStakedIota</Link>, ctx: &<b>mut</b> <Link to="../iota-framework/tx_context#0x2_tx_context_TxContext">tx_context::TxContext</Link>): (<Link to="../iota-framework/timelock#0x2_timelock_TimeLock">timelock::TimeLock</Link>&lt;<Link to="../iota-framework/balance#0x2_balance_Balance">balance::Balance</Link>&lt;<Link to="../iota-framework/iota#0x2_iota_IOTA">iota::IOTA</Link>&gt;&gt;, <Link to="../iota-framework/balance#0x2_balance_Balance">balance::Balance</Link>&lt;<Link to="../iota-framework/iota#0x2_iota_IOTA">iota::IOTA</Link>&gt;)
</code>
</pre>



<details>
<summary>Implementation</summary>


<pre>
<code>
<b>public</b> <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_request_withdraw_stake_non_entry">request_withdraw_stake_non_entry</Link>(
    <Link to="iota_system#0x3_iota_system">iota_system</Link>: &<b>mut</b> IotaSystemState,
    timelocked_staked_iota: <Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link>,
    ctx: &<b>mut</b> TxContext,
) : (TimeLock&lt;Balance&lt;IOTA&gt;&gt;, Balance&lt;IOTA&gt;) \{
    // Unpack the `<Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link>` instance.
    <b>let</b> (staked_iota, expiration_timestamp_ms, label) = timelocked_staked_iota.<Link to="timelocked_staking#0x3_timelocked_staking_unpack">unpack</Link>();

    // Store the original stake amount.
    <b>let</b> principal = staked_iota.<Link to="timelocked_staking#0x3_timelocked_staking_staked_iota_amount">staked_iota_amount</Link>();

    // Withdraw the <Link to="../iota-framework/balance#0x2_balance">balance</Link>.
    <b>let</b> <b>mut</b> withdraw_stake = <Link to="iota_system#0x3_iota_system">iota_system</Link>.<Link to="timelocked_staking#0x3_timelocked_staking_request_withdraw_stake_non_entry">request_withdraw_stake_non_entry</Link>(staked_iota, ctx);

    // The <Link to="iota_system#0x3_iota_system">iota_system</Link> withdraw functions <b>return</b> a <Link to="../iota-framework/balance#0x2_balance">balance</Link> that consists of the original staked amount plus the reward amount;
    // In here, it splits the original staked <Link to="../iota-framework/balance#0x2_balance">balance</Link> <b>to</b> <Link to="../iota-framework/timelock#0x2_timelock">timelock</Link> it again.
    <b>let</b> principal = withdraw_stake.<Link to="timelocked_staking#0x3_timelocked_staking_split">split</Link>(principal);

    // Pack and <b>return</b> a time-locked <Link to="../iota-framework/balance#0x2_balance">balance</Link>, and the reward.
    <b>let</b> sys_timelock_cap = <Link to="iota_system#0x3_iota_system">iota_system</Link>.load_system_timelock_cap();
    (<Link to="../iota-framework/timelock#0x2_timelock_system_pack">timelock::system_pack</Link>(sys_timelock_cap, principal, expiration_timestamp_ms, label, ctx), withdraw_stake)
}
</code>
</pre>



</details>

<Link id="0x3_timelocked_staking_split"></Link>

## Function `split`

Split <code><Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link></code> into two parts, one with principal <code>split_amount</code>,
and the remaining principal is left in <code>self</code>.
All the other parameters of the <code><Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link></code> like <code>stake_activation_epoch</code> or <code>pool_id</code> remain the same.


<pre>
<code>
<b>public</b> <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_split">split</Link>(self: &<b>mut</b> <Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">timelocked_staking::TimelockedStakedIota</Link>, split_amount: u64, ctx: &<b>mut</b> <Link to="../iota-framework/tx_context#0x2_tx_context_TxContext">tx_context::TxContext</Link>): <Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">timelocked_staking::TimelockedStakedIota</Link>
</code>
</pre>



<details>
<summary>Implementation</summary>


<pre>
<code>
<b>public</b> <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_split">split</Link>(self: &<b>mut</b> <Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link>, split_amount: u64, ctx: &<b>mut</b> TxContext): <Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link> \{
    <b>let</b> split_stake = self.staked_iota.<Link to="timelocked_staking#0x3_timelocked_staking_split">split</Link>(split_amount, ctx);

    <Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link> \{
        id: <Link to="../iota-framework/object#0x2_object_new">object::new</Link>(ctx),
        staked_iota: split_stake,
        expiration_timestamp_ms: self.expiration_timestamp_ms,
        label: self.label,
    }
}
</code>
</pre>



</details>

<Link id="0x3_timelocked_staking_split_staked_iota"></Link>

## Function `split_staked_iota`

Split the given <code><Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link></code> to the two parts, one with principal <code>split_amount</code>,
transfer the newly split part to the sender address.


<pre>
<code>
<b>public</b> entry <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_split_staked_iota">split_staked_iota</Link>(stake: &<b>mut</b> <Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">timelocked_staking::TimelockedStakedIota</Link>, split_amount: u64, ctx: &<b>mut</b> <Link to="../iota-framework/tx_context#0x2_tx_context_TxContext">tx_context::TxContext</Link>)
</code>
</pre>



<details>
<summary>Implementation</summary>


<pre>
<code>
<b>public</b> entry <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_split_staked_iota">split_staked_iota</Link>(stake: &<b>mut</b> <Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link>, split_amount: u64, ctx: &<b>mut</b> TxContext) \{
    <Link to="timelocked_staking#0x3_timelocked_staking_split">split</Link>(stake, split_amount, ctx).<Link to="timelocked_staking#0x3_timelocked_staking_transfer_to_sender">transfer_to_sender</Link>(ctx);
}
</code>
</pre>



</details>

<Link id="0x3_timelocked_staking_join_staked_iota"></Link>

## Function `join_staked_iota`

Consume the staked iota <code>other</code> and add its value to <code>self</code>.
Aborts if some of the staking parameters are incompatible (pool id, stake activation epoch, etc.)


<pre>
<code>
<b>public</b> entry <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_join_staked_iota">join_staked_iota</Link>(self: &<b>mut</b> <Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">timelocked_staking::TimelockedStakedIota</Link>, other: <Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">timelocked_staking::TimelockedStakedIota</Link>)
</code>
</pre>



<details>
<summary>Implementation</summary>


<pre>
<code>
<b>public</b> entry <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_join_staked_iota">join_staked_iota</Link>(self: &<b>mut</b> <Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link>, other: <Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link>) \{
    <b>assert</b>!(self.<Link to="timelocked_staking#0x3_timelocked_staking_is_equal_staking_metadata">is_equal_staking_metadata</Link>(&other), <Link to="timelocked_staking#0x3_timelocked_staking_EIncompatibleTimelockedStakedIota">EIncompatibleTimelockedStakedIota</Link>);

    <b>let</b> <Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link> \{
        id,
        staked_iota,
        expiration_timestamp_ms: _,
        label: _,
    } = other;

    id.delete();

    self.staked_iota.join(staked_iota);
}
</code>
</pre>



</details>

<Link id="0x3_timelocked_staking_transfer_to_sender"></Link>

## Function `transfer_to_sender`

A utility function to transfer a <code><Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link></code>.


<pre>
<code>
<b>public</b> <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_transfer_to_sender">transfer_to_sender</Link>(stake: <Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">timelocked_staking::TimelockedStakedIota</Link>, ctx: &<Link to="../iota-framework/tx_context#0x2_tx_context_TxContext">tx_context::TxContext</Link>)
</code>
</pre>



<details>
<summary>Implementation</summary>


<pre>
<code>
<b>public</b> <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_transfer_to_sender">transfer_to_sender</Link>(stake: <Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link>, ctx: &TxContext) \{
    <Link to="../iota-framework/transfer#0x2_transfer">transfer</Link>(stake, ctx.sender())
}
</code>
</pre>



</details>

<Link id="0x3_timelocked_staking_transfer_to_sender_multiple"></Link>

## Function `transfer_to_sender_multiple`

A utility function to transfer multiple <code><Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link></code>.


<pre>
<code>
<b>public</b> <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_transfer_to_sender_multiple">transfer_to_sender_multiple</Link>(stakes: <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;<Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">timelocked_staking::TimelockedStakedIota</Link>&gt;, ctx: &<Link to="../iota-framework/tx_context#0x2_tx_context_TxContext">tx_context::TxContext</Link>)
</code>
</pre>



<details>
<summary>Implementation</summary>


<pre>
<code>
<b>public</b> <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_transfer_to_sender_multiple">transfer_to_sender_multiple</Link>(stakes: <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;<Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link>&gt;, ctx: &TxContext) \{
    <Link to="timelocked_staking#0x3_timelocked_staking_transfer_multiple">transfer_multiple</Link>(stakes, ctx.sender())
}
</code>
</pre>



</details>

<Link id="0x3_timelocked_staking_is_equal_staking_metadata"></Link>

## Function `is_equal_staking_metadata`

A utility function that returns true if all the staking parameters
of the staked iota except the principal are identical


<pre>
<code>
<b>public</b> <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_is_equal_staking_metadata">is_equal_staking_metadata</Link>(self: &<Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">timelocked_staking::TimelockedStakedIota</Link>, other: &<Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">timelocked_staking::TimelockedStakedIota</Link>): bool
</code>
</pre>



<details>
<summary>Implementation</summary>


<pre>
<code>
<b>public</b> <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_is_equal_staking_metadata">is_equal_staking_metadata</Link>(self: &<Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link>, other: &<Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link>): bool \{
    self.staked_iota.<Link to="timelocked_staking#0x3_timelocked_staking_is_equal_staking_metadata">is_equal_staking_metadata</Link>(&other.staked_iota) &&
    (self.expiration_timestamp_ms == other.expiration_timestamp_ms) &&
    (self.<Link to="timelocked_staking#0x3_timelocked_staking_label">label</Link>() == other.<Link to="timelocked_staking#0x3_timelocked_staking_label">label</Link>())
}
</code>
</pre>



</details>

<Link id="0x3_timelocked_staking_pool_id"></Link>

## Function `pool_id`

Function to get the pool id of a <code><Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link></code>.


<pre>
<code>
<b>public</b> <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_pool_id">pool_id</Link>(self: &<Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">timelocked_staking::TimelockedStakedIota</Link>): <Link to="../iota-framework/object#0x2_object_ID">object::ID</Link>
</code>
</pre>



<details>
<summary>Implementation</summary>


<pre>
<code>
<b>public</b> <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_pool_id">pool_id</Link>(self: &<Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link>): ID \{ self.staked_iota.<Link to="timelocked_staking#0x3_timelocked_staking_pool_id">pool_id</Link>() }
</code>
</pre>



</details>

<Link id="0x3_timelocked_staking_staked_iota_amount"></Link>

## Function `staked_iota_amount`

Function to get the staked iota amount of a <code><Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link></code>.


<pre>
<code>
<b>public</b> <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_staked_iota_amount">staked_iota_amount</Link>(self: &<Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">timelocked_staking::TimelockedStakedIota</Link>): u64
</code>
</pre>



<details>
<summary>Implementation</summary>


<pre>
<code>
<b>public</b> <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_staked_iota_amount">staked_iota_amount</Link>(self: &<Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link>): u64 \{ self.staked_iota.<Link to="timelocked_staking#0x3_timelocked_staking_staked_iota_amount">staked_iota_amount</Link>() }
</code>
</pre>



</details>

<Link id="0x3_timelocked_staking_stake_activation_epoch"></Link>

## Function `stake_activation_epoch`

Function to get the stake activation epoch of a <code><Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link></code>.


<pre>
<code>
<b>public</b> <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_stake_activation_epoch">stake_activation_epoch</Link>(self: &<Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">timelocked_staking::TimelockedStakedIota</Link>): u64
</code>
</pre>



<details>
<summary>Implementation</summary>


<pre>
<code>
<b>public</b> <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_stake_activation_epoch">stake_activation_epoch</Link>(self: &<Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link>): u64 \{
    self.staked_iota.<Link to="timelocked_staking#0x3_timelocked_staking_stake_activation_epoch">stake_activation_epoch</Link>()
}
</code>
</pre>



</details>

<Link id="0x3_timelocked_staking_expiration_timestamp_ms"></Link>

## Function `expiration_timestamp_ms`

Function to get the expiration timestamp of a <code><Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link></code>.


<pre>
<code>
<b>public</b> <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_expiration_timestamp_ms">expiration_timestamp_ms</Link>(self: &<Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">timelocked_staking::TimelockedStakedIota</Link>): u64
</code>
</pre>



<details>
<summary>Implementation</summary>


<pre>
<code>
<b>public</b> <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_expiration_timestamp_ms">expiration_timestamp_ms</Link>(self: &<Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link>): u64 \{
    self.expiration_timestamp_ms
}
</code>
</pre>



</details>

<Link id="0x3_timelocked_staking_label"></Link>

## Function `label`

Function to get the label of a <code><Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link></code>.


<pre>
<code>
<b>public</b> <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_label">label</Link>(self: &<Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">timelocked_staking::TimelockedStakedIota</Link>): <Link to="../move-stdlib/option#0x1_option_Option">option::Option</Link>&lt;<Link to="../move-stdlib/string#0x1_string_String">string::String</Link>&gt;
</code>
</pre>



<details>
<summary>Implementation</summary>


<pre>
<code>
<b>public</b> <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_label">label</Link>(self: &<Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link>): Option&lt;String&gt; \{
    self.label
}
</code>
</pre>



</details>

<Link id="0x3_timelocked_staking_is_labeled_with"></Link>

## Function `is_labeled_with`

Check if a <code><Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link></code> is labeled with the type <code>L</code>.


<pre>
<code>
<b>public</b> <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_is_labeled_with">is_labeled_with</Link>&lt;L&gt;(self: &<Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">timelocked_staking::TimelockedStakedIota</Link>): bool
</code>
</pre>



<details>
<summary>Implementation</summary>


<pre>
<code>
<b>public</b> <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_is_labeled_with">is_labeled_with</Link>&lt;L&gt;(self: &<Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link>): bool \{
    <b>if</b> (self.label.is_some()) \{
        self.label.borrow() == <Link to="../iota-framework/timelock#0x2_timelock_type_name">timelock::type_name</Link>&lt;L&gt;()
    }
    <b>else</b> \{
        <b>false</b>
    }
}
</code>
</pre>



</details>

<Link id="0x3_timelocked_staking_unpack"></Link>

## Function `unpack`

A utility function to destroy a <code><Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link></code>.


<pre>
<code>
<b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_unpack">unpack</Link>(self: <Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">timelocked_staking::TimelockedStakedIota</Link>): (<Link to="staking_pool#0x3_staking_pool_StakedIota">staking_pool::StakedIota</Link>, u64, <Link to="../move-stdlib/option#0x1_option_Option">option::Option</Link>&lt;<Link to="../move-stdlib/string#0x1_string_String">string::String</Link>&gt;)
</code>
</pre>



<details>
<summary>Implementation</summary>


<pre>
<code>
<b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_unpack">unpack</Link>(self: <Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link>): (StakedIota, u64, Option&lt;String&gt;) \{
    <b>let</b> <Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link> \{
        id,
        staked_iota,
        expiration_timestamp_ms,
        label,
    } = self;

    <Link to="../iota-framework/object#0x2_object_delete">object::delete</Link>(id);

    (staked_iota, expiration_timestamp_ms, label)
}
</code>
</pre>



</details>

<Link id="0x3_timelocked_staking_transfer"></Link>

## Function `transfer`

A utility function to transfer a <code><Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link></code> to a receiver.


<pre>
<code>
<b>fun</b> <Link to="../iota-framework/transfer#0x2_transfer">transfer</Link>(stake: <Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">timelocked_staking::TimelockedStakedIota</Link>, receiver: <b>address</b>)
</code>
</pre>



<details>
<summary>Implementation</summary>


<pre>
<code>
<b>fun</b> <Link to="../iota-framework/transfer#0x2_transfer">transfer</Link>(stake: <Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link>, receiver: <b>address</b>) \{
    <Link to="../iota-framework/transfer#0x2_transfer_transfer">transfer::transfer</Link>(stake, receiver);
}
</code>
</pre>



</details>

<Link id="0x3_timelocked_staking_transfer_multiple"></Link>

## Function `transfer_multiple`

A utility function to transfer a vector of <code><Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link></code> to a receiver.


<pre>
<code>
<b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_transfer_multiple">transfer_multiple</Link>(stakes: <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;<Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">timelocked_staking::TimelockedStakedIota</Link>&gt;, receiver: <b>address</b>)
</code>
</pre>



<details>
<summary>Implementation</summary>


<pre>
<code>
<b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_transfer_multiple">transfer_multiple</Link>(<b>mut</b> stakes: <Link to="../move-stdlib/vector#0x1_vector">vector</Link>&lt;<Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link>&gt;, receiver: <b>address</b>) \{
    // Transfer all the time-locked stakes <b>to</b> the recipient.
    <b>while</b> (!stakes.is_empty()) \{
       <b>let</b> stake = stakes.pop_back();
       <Link to="../iota-framework/transfer#0x2_transfer_transfer">transfer::transfer</Link>(stake, receiver);
    };

    // Destroy the empty <Link to="../move-stdlib/vector#0x1_vector">vector</Link>.
    <Link to="../move-stdlib/vector#0x1_vector_destroy_empty">vector::destroy_empty</Link>(stakes);
}
</code>
</pre>



</details>

<Link id="0x3_timelocked_staking_request_add_stake_at_genesis"></Link>

## Function `request_add_stake_at_genesis`

Request to add timelocked stake to the validator's staking pool at genesis


<pre>
<code>
<b>public</b>(<b>friend</b>) <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_request_add_stake_at_genesis">request_add_stake_at_genesis</Link>(<Link to="validator#0x3_validator">validator</Link>: &<b>mut</b> <Link to="validator#0x3_validator_Validator">validator::Validator</Link>, stake: <Link to="../iota-framework/balance#0x2_balance_Balance">balance::Balance</Link>&lt;<Link to="../iota-framework/iota#0x2_iota_IOTA">iota::IOTA</Link>&gt;, staker_address: <b>address</b>, expiration_timestamp_ms: u64, label: <Link to="../move-stdlib/option#0x1_option_Option">option::Option</Link>&lt;<Link to="../move-stdlib/string#0x1_string_String">string::String</Link>&gt;, ctx: &<b>mut</b> <Link to="../iota-framework/tx_context#0x2_tx_context_TxContext">tx_context::TxContext</Link>)
</code>
</pre>



<details>
<summary>Implementation</summary>


<pre>
<code>
<b>public</b>(package) <b>fun</b> <Link to="timelocked_staking#0x3_timelocked_staking_request_add_stake_at_genesis">request_add_stake_at_genesis</Link>(
    <Link to="validator#0x3_validator">validator</Link>: &<b>mut</b> Validator,
    stake: Balance&lt;IOTA&gt;,
    staker_address: <b>address</b>,
    expiration_timestamp_ms: u64,
    label: Option&lt;String&gt;,
    ctx: &<b>mut</b> TxContext,
) \{
    <b>let</b> staked_iota = <Link to="validator#0x3_validator">validator</Link>.request_add_stake_at_genesis_with_receipt(stake, ctx);
    <b>let</b> timelocked_staked_iota = <Link to="timelocked_staking#0x3_timelocked_staking_TimelockedStakedIota">TimelockedStakedIota</Link> \{
        id: <Link to="../iota-framework/object#0x2_object_new">object::new</Link>(ctx),
        staked_iota,
        expiration_timestamp_ms,
        label,
    };
    <Link to="../iota-framework/transfer#0x2_transfer">transfer</Link>(timelocked_staked_iota, staker_address);
}
</code>
</pre>



</details>
